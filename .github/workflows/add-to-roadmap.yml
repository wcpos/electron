name: Add to Roadmap

on:
  issues:
    types: [opened]

jobs:
  add-to-project:
    name: Add issue to Roadmap
    runs-on: ubuntu-latest
    steps:
      - uses: actions/create-github-app-token@d72941d797fd3113feb6b93fd0dec494b13a2547 # v1
        id: app-token
        with:
          app-id: ${{ secrets.PROJECT_BOT_APP_ID }}
          private-key: ${{ secrets.PROJECT_BOT_PRIVATE_KEY }}
          owner: wcpos

      - uses: actions/add-to-project@244f685bbc3b7adfa8466e08b698b5577571133e # v1.0.2
        id: add
        with:
          project-url: https://github.com/orgs/wcpos/projects/4
          github-token: ${{ steps.app-token.outputs.token }}

      - name: Set status to Triage
        env:
          GH_TOKEN: ${{ steps.app-token.outputs.token }}
        run: |
          gh api graphql -f query='
            mutation {
              updateProjectV2ItemFieldValue(input: {
                projectId: "PVT_kwDOAuNIQc4ADana"
                itemId: "${{ steps.add.outputs.itemId }}"
                fieldId: "PVTSSF_lADOAuNIQc4ADanazgB9yM4"
                value: { singleSelectOptionId: "809e15bf" }
              }) {
                projectV2Item { id }
              }
            }'
